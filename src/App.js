import { useEffect, useRef, useState } from "react";
import "./App.css";

const filtros = [
  {
    nome: "pomodoro",
    modo: "pomodoro",
    duracao: 25 * 60,
  },
  {
    nome: "short break",
    modo: "short break",
    duracao: 5 * 60,
  },
  {
    nome: "long break",
    modo: "long break",
    duracao: 15 * 60,
  },
];

function App() {
  const [modo, setModo] = useState("pomodoro");
  const [tempo, setTempo] = useState(filtros[0].duracao);
  const [contando, setContando] = useState(false);

  const intervalId = useRef(null);

  //este ocorre quando o modo é alterado
  //no onClick no filtros.map haverá uma alteração no modo e então este useEffect será chamado
  useEffect(() => {
    const modoSelecionado = filtros.find((m) => m.modo === modo);
    setTempo(modoSelecionado.duracao);
    setContando(false);
  }, [modo]);

  useEffect(() => {
    if (contando) {
      intervalId.current = setInterval(() => {
        setTempo((tempoAnterior) => {
          if (tempoAnterior > 0) {
            return tempoAnterior - 1;
          } else {
            return 0;
          }
        });
      }, 1000);
    }
    return () => {
      clearInterval(intervalId.current);
    };
  }, [contando]);

  return (
    <div className="App">
      <svg xmlns="http://www.w3.org/2000/svg" width="153" height="32">
        <path
          fill="#D7E0FF"
          d="M4.578 31.813v-9.36a7.383 7.383 0 004.984 1.86c1.47 0 2.777-.352 3.922-1.055 1.146-.703 2.047-1.667 2.704-2.89.656-1.225.984-2.618.984-4.18 0-1.563-.328-2.956-.985-4.18-.656-1.224-1.557-2.188-2.703-2.89-1.145-.704-2.453-1.056-3.921-1.056-1.01 0-1.954.175-2.829.524a6.985 6.985 0 00-2.296 1.476l-.11-1.687H.078v23.438h4.5zm3.969-11.407c-1.146 0-2.094-.4-2.844-1.203-.75-.802-1.125-1.807-1.125-3.015 0-1.209.375-2.214 1.125-3.016s1.698-1.203 2.844-1.203 2.094.4 2.844 1.203c.75.802 1.125 1.807 1.125 3.015 0 1.209-.375 2.214-1.125 3.016s-1.698 1.203-2.844 1.203zm18.844 3.907c1.604 0 3.03-.352 4.28-1.055a7.85 7.85 0 002.962-2.89c.724-1.225 1.086-2.618 1.086-4.18 0-1.563-.362-2.956-1.086-4.18a7.85 7.85 0 00-2.961-2.89c-1.25-.704-2.677-1.056-4.281-1.056-1.605 0-3.034.352-4.29 1.055a7.834 7.834 0 00-2.968 2.89c-.724 1.225-1.086 2.618-1.086 4.18 0 1.563.362 2.956 1.086 4.18a7.834 7.834 0 002.969 2.89c1.255.704 2.684 1.055 4.289 1.055zm0-3.907c-1.146 0-2.094-.4-2.844-1.203-.75-.802-1.125-1.807-1.125-3.015 0-1.209.375-2.214 1.125-3.016s1.698-1.203 2.844-1.203c1.145 0 2.093.4 2.843 1.203.75.802 1.125 1.807 1.125 3.015 0 1.209-.375 2.214-1.125 3.016s-1.698 1.203-2.843 1.203zM43.188 24v-8.297c0-1.24.286-2.172.859-2.797s1.266-.937 2.078-.937c.802 0 1.487.302 2.055.906.567.604.851 1.51.851 2.719V24h4.5v-8.297c0-1.24.287-2.172.86-2.797s1.265-.937 2.078-.937c.802 0 1.487.302 2.054.906.568.604.852 1.51.852 2.719V24h4.5v-8.406c0-2.365-.526-4.211-1.578-5.54-1.052-1.327-2.526-1.992-4.422-1.992-1.198 0-2.24.266-3.125.797-.885.532-1.589 1.292-2.11 2.282-1-2.052-2.703-3.079-5.109-3.079-1.885 0-3.38.657-4.484 1.97l-.11-1.657h-4.25V24h4.5zm31.687.313c1.604 0 3.031-.352 4.281-1.055a7.85 7.85 0 002.961-2.89c.724-1.225 1.086-2.618 1.086-4.18 0-1.563-.362-2.956-1.086-4.18a7.85 7.85 0 00-2.96-2.89c-1.25-.704-2.678-1.056-4.282-1.056s-3.034.352-4.29 1.055a7.834 7.834 0 00-2.968 2.89c-.724 1.225-1.086 2.618-1.086 4.18 0 1.563.362 2.956 1.086 4.18a7.834 7.834 0 002.969 2.89c1.255.704 2.685 1.055 4.289 1.055zm0-3.907c-1.146 0-2.094-.4-2.844-1.203-.75-.802-1.125-1.807-1.125-3.015 0-1.209.375-2.214 1.125-3.016s1.698-1.203 2.844-1.203 2.094.4 2.844 1.203c.75.802 1.125 1.807 1.125 3.015 0 1.209-.375 2.214-1.125 3.016s-1.698 1.203-2.844 1.203zm17.813 3.907c1.02 0 1.966-.175 2.835-.524a7.005 7.005 0 002.29-1.477L97.921 24h4.25V.562h-4.5v9.36a7.383 7.383 0 00-4.984-1.86c-1.459 0-2.764.352-3.915 1.055a7.433 7.433 0 00-2.71 2.89c-.657 1.225-.985 2.618-.985 4.18 0 1.563.328 2.956.984 4.18a7.433 7.433 0 002.711 2.89c1.151.704 2.456 1.055 3.915 1.055zm1.015-3.907c-1.146 0-2.094-.4-2.844-1.203-.75-.802-1.125-1.807-1.125-3.015 0-1.209.375-2.214 1.125-3.016s1.698-1.203 2.844-1.203 2.094.4 2.844 1.203c.75.802 1.125 1.807 1.125 3.015 0 1.209-.375 2.214-1.125 3.016s-1.698 1.203-2.844 1.203zm19.781 3.907c1.605 0 3.032-.352 4.282-1.055a7.85 7.85 0 002.96-2.89c.725-1.225 1.087-2.618 1.087-4.18 0-1.563-.362-2.956-1.086-4.18a7.85 7.85 0 00-2.961-2.89c-1.25-.704-2.677-1.056-4.282-1.056-1.604 0-3.033.352-4.289 1.055a7.834 7.834 0 00-2.968 2.89c-.724 1.225-1.086 2.618-1.086 4.18 0 1.563.362 2.956 1.086 4.18a7.834 7.834 0 002.968 2.89c1.256.704 2.685 1.055 4.29 1.055zm0-3.907c-1.145 0-2.093-.4-2.843-1.203-.75-.802-1.125-1.807-1.125-3.015 0-1.209.375-2.214 1.125-3.016s1.698-1.203 2.843-1.203c1.146 0 2.094.4 2.844 1.203.75.802 1.125 1.807 1.125 3.015 0 1.209-.375 2.214-1.125 3.016s-1.698 1.203-2.844 1.203zM129.281 24v-6.89c0-1.646.37-2.915 1.11-3.805.74-.89 1.713-1.336 2.922-1.336a5.7 5.7 0 011.78.297l.626-3.891a7.505 7.505 0 00-2.094-.313c-1.99 0-3.552.85-4.688 2.547l-.218-2.234h-3.938V24h4.5zm15.406.313c1.605 0 3.032-.352 4.282-1.055a7.85 7.85 0 002.96-2.89c.725-1.225 1.087-2.618 1.087-4.18 0-1.563-.362-2.956-1.086-4.18a7.85 7.85 0 00-2.961-2.89c-1.25-.704-2.677-1.056-4.281-1.056-1.605 0-3.034.352-4.29 1.055a7.834 7.834 0 00-2.968 2.89c-.724 1.225-1.086 2.618-1.086 4.18 0 1.563.362 2.956 1.086 4.18a7.834 7.834 0 002.968 2.89c1.256.704 2.685 1.055 4.29 1.055zm0-3.907c-1.145 0-2.093-.4-2.843-1.203-.75-.802-1.125-1.807-1.125-3.015 0-1.209.375-2.214 1.125-3.016s1.698-1.203 2.844-1.203c1.145 0 2.093.4 2.843 1.203.75.802 1.125 1.807 1.125 3.015 0 1.209-.375 2.214-1.125 3.016s-1.698 1.203-2.844 1.203z"
        />
      </svg>

      <div className="modos">
        {filtros.map((b) => (
          <button
            className={modo === b.modo ? "modo-selecionado" : ""}
            onClick={() => {
              setModo(b.modo);
              setTempo(b.duracao);
            }}
          >
            {b.nome}
          </button>
        ))}
      </div>

      <div className="cronometro">
        <div className="container-tempo">
          <div className="tempo">
            {String(Math.floor(tempo / 60)).padStart(2, "0")}:
            {String(tempo % 60).padStart(2, "0")}
          </div>
          <button onClick={() => setContando((contando) => !contando)}>
            {contando ? "pause" : "iniciar"}
          </button>
        </div>
      </div>

      <button className="btn-configuracao">
        <svg
          width="28"
          height="28"
          viewBox="0 0 28 28"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M24.0377 15.365L26.9653 17.682C27.2289 17.899 27.3053 18.2771 27.1318 18.578L24.3567 23.429C24.1833 23.73 23.8226 23.849 23.5104 23.73L20.0555 22.323C19.3409 22.883 18.5569 23.345 17.7106 23.702L17.1903 27.412C17.1348 27.741 16.8503 28 16.5034 28H10.9534C10.6065 28 10.3221 27.741 10.2666 27.412L9.74627 23.702C8.89991 23.345 8.11598 22.8761 7.40139 22.323L3.94648 23.73C3.63429 23.856 3.27358 23.73 3.10012 23.429L0.325071 18.578C0.15161 18.27 0.227967 17.892 0.491573 17.682L3.4192 15.365C3.36373 14.917 3.3221 14.462 3.3221 14C3.3221 13.538 3.36373 13.083 3.4192 12.635L0.491573 10.318C0.227967 10.101 0.15161 9.72302 0.325071 9.42199L3.10019 4.57099C3.27358 4.26996 3.63436 4.15098 3.94655 4.26996L7.40146 5.67697C8.11598 5.11699 8.89997 4.65499 9.74633 4.29799L10.2667 0.588001C10.3221 0.259022 10.6066 0 10.9535 0H16.5035C16.8504 0 17.1348 0.259022 17.1973 0.588001L17.7176 4.29799C18.564 4.65499 19.3479 5.12394 20.0625 5.67697L23.5174 4.26996C23.8296 4.14396 24.1903 4.26996 24.3637 4.57099L27.1388 9.42199C27.3123 9.72997 27.2359 10.108 26.9723 10.318L24.0377 12.635C24.0932 13.083 24.1348 13.538 24.1348 14C24.1348 14.462 24.0932 14.917 24.0377 15.365ZM8.87213 14C8.87213 16.709 11.0436 18.9 13.7285 18.9C16.4133 18.9 18.5848 16.7091 18.5848 14.0001C18.5848 11.2911 16.4133 9.10004 13.7285 9.10004C11.0436 9.10004 8.87213 11.291 8.87213 14Z"
            fill="#D7E0FF"
          />
        </svg>
      </button>
      {/* <div className="modal">
            <div className="headerModal">
              <h1>Settings</h1>
            </div>
            <div className="titleModal">
              <h2>TIME (MINUTES)</h2>
            </div>
      </div> */}
    </div>
  );
}

export default App;